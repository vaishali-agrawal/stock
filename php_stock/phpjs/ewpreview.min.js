/**
 * Detail Preview Extension
 * @license (C)2015 e.World Technology Ltd.
 */function ew_AddRowToTable(e){var t=jQuery,n=t(e),r,i,s=0,o=n.closest("tbody");EW_PREVIEW_SINGLE_ROW&&o.find("tr."+EW_TABLE_PREVIEW_ROW_CLASSNAME).remove(),t(e.cells).each(function(){s+=this.colSpan});var u=n.nextAll("tr[data-rowindex!="+n.data("rowindex")+"]").first();if(u.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME))return u[0];if(r=o[0].insertRow(u[0]?u[0].sectionRowIndex:-1))t(r).addClass(EW_TABLE_PREVIEW_ROW_CLASSNAME),i=t(r.insertCell(0)).addClass(EW_TABLE_LAST_COL_CLASSNAME).prop("colSpan",s);return r}function ew_ShowDetails(e){var t=jQuery,n=t(this),r=n.is("tr[data-rowindex]"),i=r?n:n.closest("tr[data-rowindex]"),s=i.closest("table");if(!i[0])return;if(!i.data("preview")){var o=ew_AddRowToTable(i[0]),u=t(o.cells[0]),a=i.find("[class$=_preview] div.ewPreview");u.empty(),u.append(t("#ewPreview").contents().clone()).find(".nav-tabs").append(a.find("li:has([data-toggle='tab'])").clone(!0)).find("[data-toggle='tab']").attr("data-target","#"+u.find(".tab-pane").attr("id",ew_Random()).attr("id")).first().tab("show"),(EW_PREVIEW_SINGLE_ROW?s:i).find(EW_PREVIEW_BUTTON_SELECTOR).addClass("icon-expand").removeClass("icon-collapse"),i.data("preview",!0).find(EW_PREVIEW_BUTTON_SELECTOR).addClass("icon-collapse").removeClass("icon-expand")}else{var f=i.nextAll("tr[data-rowindex!='"+i.data("rowindex")+"']").first();f.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME)&&f.remove(),i.data("preview",!1).find(EW_PREVIEW_BUTTON_SELECTOR).addClass("icon-expand").removeClass("icon-collapse")}ew_SetupTable(-1,s[0],!0)}function ew_Detail(e,t){var n=jQuery,r=n(t),i=r.closest(".ewListOptionBody"),s=r.data("placement")||EW_PREVIEW_PLACEMENT,o=i.find(".dropdown-menu"),u=i.find(".btn-group");o.mouseenter(function(e){e.stopPropagation()}),u[0]&&(s=="right"&&o.addClass("pull-right"),r=u);if(r.data("bs.popover"))return;r.popover({html:!0,delay:{show:100,hide:250},placement:s,trigger:"hover",container:n("#ewTooltip")[0],content:EW_PREVIEW_LOADING_HTML}).on("show.bs.popover",function(e){n(".popover.ewPreviewOverlay").hide(),r.data("bs.popover").tip().css("opacity",0)}).on("shown.bs.popover",function(e){var t=r.data("bs.popover").tip().css({"min-width":"200px","max-width":"1000px"});t.find(".popover-content").html(n("#ewPreview").html()),t.find(".nav-tabs").append(i.find("li:has([data-toggle='tab'])").clone(!0)),t.find("[data-toggle='tab']").attr("data-target","#"+t.find(".tab-pane").attr("id",ew_Random()).attr("id")).data("$element",r).first().tab("show"),ew_MoveTip(r),t.fadeTo(0,1).addClass("ewPreviewOverlay")}).data("bs.popover").tip().mouseenter(function(e){clearTimeout(r.data("bs.popover").timeout)}).mouseleave(function(e){var t=r.data("bs.popover");if(t.tip().html().indexOf(EW_PREVIEW_LOADING_HTML)>-1)return;t.timeout=setTimeout(function(){t.hide.call(t)},t.options.delay.hide)})}function ew_MoveTip(e){var t=jQuery,n=e.data("placement")||EW_PREVIEW_PLACEMENT;if(n!="left"&&n!="right")return;var r=t(document),i=t(document.body),s=e.data("bs.popover").tip(),o=s.width(),u=s.offset(),a=e.parent();bottom=r.scrollTop()+i.outerHeight()-s.outerHeight(),a.hasClass("btn-group")&&(e=a,a=e.parent());var f=e.offset();u.top=f.top+e.height()/2-s.height()/2,u.top=Math.max(r.scrollTop(),Math.min(bottom,u.top)),s.css("top",u.top+"px"),n=="right"&&e.is(".btn-group")&&s.css("left",f.left+e.width());var l=s.find(".arrow");n=="left"&&(left=f.left-s.outerWidth()-l.width(),s.css("left",left));var c=f.top-u.top+e.height()/2-l.height(),h=(parseInt(s.css("border-top-left-radius"),10)||6)-parseInt(l.css("margin-top"),10),p=s.height()-h-l.height();l.css("top",Math.max(h,Math.min(c,p))+"px")}function ew_TabShow(e){var t=jQuery,n=t(e.target),r=n.data("url"),i=n.data("table"),s=t(n.attr("data-target"));r&&s[0]&&(s.empty().html(EW_PREVIEW_LOADING_HTML),t.get(r,function(e){s.empty().html(e).append(t("div[data-table='"+i+"'][data-url='"+r+"']:first").clone()),t(document).trigger("preview",[{$tabpane:s}]),n.data("$element")&&ew_MoveTip(n.data("$element"))}))}function ew_Preview(e,t){var n=t.$tabpane;n.find("table."+EW_TABLE_CLASSNAME).each(ew_SetupTable),ew_InitIcons(),n.find("a.ewTooltipLink").each(ew_Tooltip),$(".ewLightbox").each(function(){var e=$(this);e.colorbox($.extend({rel:e.data("rel")},ewLightboxSettings))})}var EW_PREVIEW_LOADING_HTML="<div class='ewSpinner'><div></div></div> "+ewLanguage.Phrase("Loading"),EW_PREVIEW_BUTTON_SELECTOR=".ewPreviewRowBtn";jQuery(document).on("preview",ew_Preview),jQuery(function(e){EW_PREVIEW_OVERLAY&&e("div.ewPreview").each(function(){e(this).parent().find("[data-action='view'],[data-action='list']").each(ew_Detail)}),e(EW_PREVIEW_BUTTON_SELECTOR).click(ew_ShowDetails),e("div.ewPreview [data-toggle='tab']").on("show.bs.tab",ew_TabShow)});